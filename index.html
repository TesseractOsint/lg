const express = require('express');
const fetch = require('node-fetch');
const app = express();

const BOT_TOKEN = '–í–ê–®_–¢–û–ö–ï–ù_–ë–û–¢–ê';
const CHAT_ID = '–í–ê–®_CHAT_ID'; // –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
const PORT = 3000;

app.use(express.json());

app.get('/', async (req, res) => {
  const u = req.query.u;
  const ip = req.headers['x-forwarded-for'] || req.socket.remoteAddress;

  if (!u) {
    return res.status(400).send('Missing "u" parameter');
  }

  const message = `üë§ –ù–æ–≤—ã–π –ø–µ—Ä–µ—Ö–æ–¥\nüîó u: ${u}\nüåê IP: ${ip}`;

  try {
    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        chat_id: CHAT_ID,
        text: message
      })
    });

    res.send('OK');
  } catch (err) {
    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram:', err);
    res.status(500).send('–û—à–∏–±–∫–∞');
  }
});

app.listen(PORT, () => {
  console.log(`–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É ${PORT}`);
});
